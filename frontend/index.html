<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>WARFORT</title>
<style>
    body { margin:0; background:#111; overflow:hidden; }
    canvas { background:#222; display:block; margin:0 auto; }
    #ui {
        position:fixed;
        top:10px;
        left:10px;
        color:white;
        font-family:sans-serif;
        background:rgba(0,0,0,0.5);
        padding:10px;
        border-radius:5px;
    }
    input { padding:5px; }
    button { padding:5px; margin-top:5px; }
</style>
</head>

<body>
<div id="ui">
    <div>
        <label>Nombre:</label>
        <input id="nameInput" placeholder="Tu nombre">
        <button onclick="startGame()">Entrar</button>
    </div>
    <div id="stats" style="display:none;">
        <p>Vida: <span id="hp">100</span></p>
        <p>Madera: <span id="wood">0</span></p>
        <p>Piedra: <span id="stone">0</span></p>
        <p>Comida: <span id="food">0</span></p>
        <p>Oro: <span id="gold">0</span></p>
    </div>
</div>

<canvas id="game" width="900" height="600"></canvas>

<script src="https://cdn.socket.io/4.7.5/socket.io.min.js"></script>

<script>
/* ============================
     CONFIGURACIÃ“N SOCKET.IO
   ============================ */

const SERVER_URL = "https://warfort.onrender.com";  // TU SERVIDOR
let socket = null;

/* ============================
     VARIABLES DEL JUEGO
   ============================ */

const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");

let username = "";
let player = {
    x: 400,
    y: 300,
    speed: 3,
    hp: 100,
    wood: 0,
    stone: 0,
    food: 0,
    gold: 0,
    fort: null
};

let otherPlayers = {};
let map = { trees:[], bushes:[], stones:[], animals:[], wheels:[], forts:[] };

let keys = {};

/* ============================
        INICIAR EL JUEGO
   ============================ */

function startGame() {
    const name = document.getElementById("nameInput").value.trim();
    if (!name) return alert("Escribe un nombre para entrar.");

    username = name;

    document.getElementById("stats").style.display = "block";

    // conectar a servidor
    socket = io(SERVER_URL, { transports:["websocket"] });

    socket.on("connect", () => {
        socket.emit("join", { name: username, x: player.x, y: player.y });
    });

    socket.on("init", data => {
        map = data.map;
        otherPlayers = data.players;
    });

    socket.on("state", data => {
        if (data.players) {
            for (let id in data.players) {
                if (data.players[id] === null) delete otherPlayers[id];
                else otherPlayers[id] = data.players[id];
            }
        }
        if (data.map) map = data.map;
    });

    loop();
}

/* ============================
          MOVIMIENTO
   ============================ */

document.addEventListener("keydown", e => keys[e.key] = true);
document.addEventListener("keyup",   e => keys[e.key] = false);

function updatePlayer() {
    if (keys["w"]) player.y -= player.speed;
    if (keys["s"]) player.y += player.speed;
    if (keys["a"]) player.x -= player.speed;
    if (keys["d"]) player.x += player.speed;

    socket.emit("update", { x: player.x, y: player.y });
}

/* ============================
        DIBUJAR JUEGO
   ============================ */

function draw() {
    ctx.clearRect(0,0,canvas.width,canvas.height);

    // jugador local
    ctx.fillStyle = "cyan";
    ctx.beginPath();
    ctx.arc(player.x, player.y, 10, 0, Math.PI*2);
    ctx.fill();

    // otros jugadores
    ctx.fillStyle = "yellow";
    for (let id in otherPlayers) {
        const p = otherPlayers[id];
        ctx.beginPath();
        ctx.arc(p.x, p.y, 10, 0, Math.PI*2);
        ctx.fill();
    }
}

/* ============================
            LOOP
   ============================ */

function loop() {
    updatePlayer();
    draw();
    requestAnimationFrame(loop);
}
</script>

</body>
</html>
